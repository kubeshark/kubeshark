{"ast":null,"code":"'use strict';\n\nconst Tokenizer = require('../tokenizer');\n\nconst HTML = require('./html'); //Aliases\n\n\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\nconst ATTRS = HTML.ATTRS; //MIME types\n\nconst MIME_TYPES = {\n  TEXT_HTML: 'text/html',\n  APPLICATION_XML: 'application/xhtml+xml'\n}; //Attributes\n\nconst DEFINITION_URL_ATTR = 'definitionurl';\nconst ADJUSTED_DEFINITION_URL_ATTR = 'definitionURL';\nconst SVG_ATTRS_ADJUSTMENT_MAP = {\n  attributename: 'attributeName',\n  attributetype: 'attributeType',\n  basefrequency: 'baseFrequency',\n  baseprofile: 'baseProfile',\n  calcmode: 'calcMode',\n  clippathunits: 'clipPathUnits',\n  diffuseconstant: 'diffuseConstant',\n  edgemode: 'edgeMode',\n  filterunits: 'filterUnits',\n  glyphref: 'glyphRef',\n  gradienttransform: 'gradientTransform',\n  gradientunits: 'gradientUnits',\n  kernelmatrix: 'kernelMatrix',\n  kernelunitlength: 'kernelUnitLength',\n  keypoints: 'keyPoints',\n  keysplines: 'keySplines',\n  keytimes: 'keyTimes',\n  lengthadjust: 'lengthAdjust',\n  limitingconeangle: 'limitingConeAngle',\n  markerheight: 'markerHeight',\n  markerunits: 'markerUnits',\n  markerwidth: 'markerWidth',\n  maskcontentunits: 'maskContentUnits',\n  maskunits: 'maskUnits',\n  numoctaves: 'numOctaves',\n  pathlength: 'pathLength',\n  patterncontentunits: 'patternContentUnits',\n  patterntransform: 'patternTransform',\n  patternunits: 'patternUnits',\n  pointsatx: 'pointsAtX',\n  pointsaty: 'pointsAtY',\n  pointsatz: 'pointsAtZ',\n  preservealpha: 'preserveAlpha',\n  preserveaspectratio: 'preserveAspectRatio',\n  primitiveunits: 'primitiveUnits',\n  refx: 'refX',\n  refy: 'refY',\n  repeatcount: 'repeatCount',\n  repeatdur: 'repeatDur',\n  requiredextensions: 'requiredExtensions',\n  requiredfeatures: 'requiredFeatures',\n  specularconstant: 'specularConstant',\n  specularexponent: 'specularExponent',\n  spreadmethod: 'spreadMethod',\n  startoffset: 'startOffset',\n  stddeviation: 'stdDeviation',\n  stitchtiles: 'stitchTiles',\n  surfacescale: 'surfaceScale',\n  systemlanguage: 'systemLanguage',\n  tablevalues: 'tableValues',\n  targetx: 'targetX',\n  targety: 'targetY',\n  textlength: 'textLength',\n  viewbox: 'viewBox',\n  viewtarget: 'viewTarget',\n  xchannelselector: 'xChannelSelector',\n  ychannelselector: 'yChannelSelector',\n  zoomandpan: 'zoomAndPan'\n};\nconst XML_ATTRS_ADJUSTMENT_MAP = {\n  'xlink:actuate': {\n    prefix: 'xlink',\n    name: 'actuate',\n    namespace: NS.XLINK\n  },\n  'xlink:arcrole': {\n    prefix: 'xlink',\n    name: 'arcrole',\n    namespace: NS.XLINK\n  },\n  'xlink:href': {\n    prefix: 'xlink',\n    name: 'href',\n    namespace: NS.XLINK\n  },\n  'xlink:role': {\n    prefix: 'xlink',\n    name: 'role',\n    namespace: NS.XLINK\n  },\n  'xlink:show': {\n    prefix: 'xlink',\n    name: 'show',\n    namespace: NS.XLINK\n  },\n  'xlink:title': {\n    prefix: 'xlink',\n    name: 'title',\n    namespace: NS.XLINK\n  },\n  'xlink:type': {\n    prefix: 'xlink',\n    name: 'type',\n    namespace: NS.XLINK\n  },\n  'xml:base': {\n    prefix: 'xml',\n    name: 'base',\n    namespace: NS.XML\n  },\n  'xml:lang': {\n    prefix: 'xml',\n    name: 'lang',\n    namespace: NS.XML\n  },\n  'xml:space': {\n    prefix: 'xml',\n    name: 'space',\n    namespace: NS.XML\n  },\n  xmlns: {\n    prefix: '',\n    name: 'xmlns',\n    namespace: NS.XMLNS\n  },\n  'xmlns:xlink': {\n    prefix: 'xmlns',\n    name: 'xlink',\n    namespace: NS.XMLNS\n  }\n}; //SVG tag names adjustment map\n\nconst SVG_TAG_NAMES_ADJUSTMENT_MAP = exports.SVG_TAG_NAMES_ADJUSTMENT_MAP = {\n  altglyph: 'altGlyph',\n  altglyphdef: 'altGlyphDef',\n  altglyphitem: 'altGlyphItem',\n  animatecolor: 'animateColor',\n  animatemotion: 'animateMotion',\n  animatetransform: 'animateTransform',\n  clippath: 'clipPath',\n  feblend: 'feBlend',\n  fecolormatrix: 'feColorMatrix',\n  fecomponenttransfer: 'feComponentTransfer',\n  fecomposite: 'feComposite',\n  feconvolvematrix: 'feConvolveMatrix',\n  fediffuselighting: 'feDiffuseLighting',\n  fedisplacementmap: 'feDisplacementMap',\n  fedistantlight: 'feDistantLight',\n  feflood: 'feFlood',\n  fefunca: 'feFuncA',\n  fefuncb: 'feFuncB',\n  fefuncg: 'feFuncG',\n  fefuncr: 'feFuncR',\n  fegaussianblur: 'feGaussianBlur',\n  feimage: 'feImage',\n  femerge: 'feMerge',\n  femergenode: 'feMergeNode',\n  femorphology: 'feMorphology',\n  feoffset: 'feOffset',\n  fepointlight: 'fePointLight',\n  fespecularlighting: 'feSpecularLighting',\n  fespotlight: 'feSpotLight',\n  fetile: 'feTile',\n  feturbulence: 'feTurbulence',\n  foreignobject: 'foreignObject',\n  glyphref: 'glyphRef',\n  lineargradient: 'linearGradient',\n  radialgradient: 'radialGradient',\n  textpath: 'textPath'\n}; //Tags that causes exit from foreign content\n\nconst EXITS_FOREIGN_CONTENT = {\n  [$.B]: true,\n  [$.BIG]: true,\n  [$.BLOCKQUOTE]: true,\n  [$.BODY]: true,\n  [$.BR]: true,\n  [$.CENTER]: true,\n  [$.CODE]: true,\n  [$.DD]: true,\n  [$.DIV]: true,\n  [$.DL]: true,\n  [$.DT]: true,\n  [$.EM]: true,\n  [$.EMBED]: true,\n  [$.H1]: true,\n  [$.H2]: true,\n  [$.H3]: true,\n  [$.H4]: true,\n  [$.H5]: true,\n  [$.H6]: true,\n  [$.HEAD]: true,\n  [$.HR]: true,\n  [$.I]: true,\n  [$.IMG]: true,\n  [$.LI]: true,\n  [$.LISTING]: true,\n  [$.MENU]: true,\n  [$.META]: true,\n  [$.NOBR]: true,\n  [$.OL]: true,\n  [$.P]: true,\n  [$.PRE]: true,\n  [$.RUBY]: true,\n  [$.S]: true,\n  [$.SMALL]: true,\n  [$.SPAN]: true,\n  [$.STRONG]: true,\n  [$.STRIKE]: true,\n  [$.SUB]: true,\n  [$.SUP]: true,\n  [$.TABLE]: true,\n  [$.TT]: true,\n  [$.U]: true,\n  [$.UL]: true,\n  [$.VAR]: true\n}; //Check exit from foreign content\n\nexports.causesExit = function (startTagToken) {\n  const tn = startTagToken.tagName;\n  const isFontWithAttrs = tn === $.FONT && (Tokenizer.getTokenAttr(startTagToken, ATTRS.COLOR) !== null || Tokenizer.getTokenAttr(startTagToken, ATTRS.SIZE) !== null || Tokenizer.getTokenAttr(startTagToken, ATTRS.FACE) !== null);\n  return isFontWithAttrs ? true : EXITS_FOREIGN_CONTENT[tn];\n}; //Token adjustments\n\n\nexports.adjustTokenMathMLAttrs = function (token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    if (token.attrs[i].name === DEFINITION_URL_ATTR) {\n      token.attrs[i].name = ADJUSTED_DEFINITION_URL_ATTR;\n      break;\n    }\n  }\n};\n\nexports.adjustTokenSVGAttrs = function (token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    const adjustedAttrName = SVG_ATTRS_ADJUSTMENT_MAP[token.attrs[i].name];\n\n    if (adjustedAttrName) {\n      token.attrs[i].name = adjustedAttrName;\n    }\n  }\n};\n\nexports.adjustTokenXMLAttrs = function (token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    const adjustedAttrEntry = XML_ATTRS_ADJUSTMENT_MAP[token.attrs[i].name];\n\n    if (adjustedAttrEntry) {\n      token.attrs[i].prefix = adjustedAttrEntry.prefix;\n      token.attrs[i].name = adjustedAttrEntry.name;\n      token.attrs[i].namespace = adjustedAttrEntry.namespace;\n    }\n  }\n};\n\nexports.adjustTokenSVGTagName = function (token) {\n  const adjustedTagName = SVG_TAG_NAMES_ADJUSTMENT_MAP[token.tagName];\n\n  if (adjustedTagName) {\n    token.tagName = adjustedTagName;\n  }\n}; //Integration points\n\n\nfunction isMathMLTextIntegrationPoint(tn, ns) {\n  return ns === NS.MATHML && (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS || tn === $.MTEXT);\n}\n\nfunction isHtmlIntegrationPoint(tn, ns, attrs) {\n  if (ns === NS.MATHML && tn === $.ANNOTATION_XML) {\n    for (let i = 0; i < attrs.length; i++) {\n      if (attrs[i].name === ATTRS.ENCODING) {\n        const value = attrs[i].value.toLowerCase();\n        return value === MIME_TYPES.TEXT_HTML || value === MIME_TYPES.APPLICATION_XML;\n      }\n    }\n  }\n\n  return ns === NS.SVG && (tn === $.FOREIGN_OBJECT || tn === $.DESC || tn === $.TITLE);\n}\n\nexports.isIntegrationPoint = function (tn, ns, attrs, foreignNS) {\n  if ((!foreignNS || foreignNS === NS.HTML) && isHtmlIntegrationPoint(tn, ns, attrs)) {\n    return true;\n  }\n\n  if ((!foreignNS || foreignNS === NS.MATHML) && isMathMLTextIntegrationPoint(tn, ns)) {\n    return true;\n  }\n\n  return false;\n};","map":{"version":3,"sources":["/Users/leon/lib-test/liraz-test/node_modules/parse5/lib/common/foreign-content.js"],"names":["Tokenizer","require","HTML","$","TAG_NAMES","NS","NAMESPACES","ATTRS","MIME_TYPES","TEXT_HTML","APPLICATION_XML","DEFINITION_URL_ATTR","ADJUSTED_DEFINITION_URL_ATTR","SVG_ATTRS_ADJUSTMENT_MAP","attributename","attributetype","basefrequency","baseprofile","calcmode","clippathunits","diffuseconstant","edgemode","filterunits","glyphref","gradienttransform","gradientunits","kernelmatrix","kernelunitlength","keypoints","keysplines","keytimes","lengthadjust","limitingconeangle","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","numoctaves","pathlength","patterncontentunits","patterntransform","patternunits","pointsatx","pointsaty","pointsatz","preservealpha","preserveaspectratio","primitiveunits","refx","refy","repeatcount","repeatdur","requiredextensions","requiredfeatures","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","surfacescale","systemlanguage","tablevalues","targetx","targety","textlength","viewbox","viewtarget","xchannelselector","ychannelselector","zoomandpan","XML_ATTRS_ADJUSTMENT_MAP","prefix","name","namespace","XLINK","XML","xmlns","XMLNS","SVG_TAG_NAMES_ADJUSTMENT_MAP","exports","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","clippath","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","foreignobject","lineargradient","radialgradient","textpath","EXITS_FOREIGN_CONTENT","B","BIG","BLOCKQUOTE","BODY","BR","CENTER","CODE","DD","DIV","DL","DT","EM","EMBED","H1","H2","H3","H4","H5","H6","HEAD","HR","I","IMG","LI","LISTING","MENU","META","NOBR","OL","P","PRE","RUBY","S","SMALL","SPAN","STRONG","STRIKE","SUB","SUP","TABLE","TT","U","UL","VAR","causesExit","startTagToken","tn","tagName","isFontWithAttrs","FONT","getTokenAttr","COLOR","SIZE","FACE","adjustTokenMathMLAttrs","token","i","attrs","length","adjustTokenSVGAttrs","adjustedAttrName","adjustTokenXMLAttrs","adjustedAttrEntry","adjustTokenSVGTagName","adjustedTagName","isMathMLTextIntegrationPoint","ns","MATHML","MI","MO","MN","MS","MTEXT","isHtmlIntegrationPoint","ANNOTATION_XML","ENCODING","value","toLowerCase","SVG","FOREIGN_OBJECT","DESC","TITLE","isIntegrationPoint","foreignNS"],"mappings":"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","sourcesContent":["'use strict';\n\nconst Tokenizer = require('../tokenizer');\nconst HTML = require('./html');\n\n//Aliases\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\nconst ATTRS = HTML.ATTRS;\n\n//MIME types\nconst MIME_TYPES = {\n    TEXT_HTML: 'text/html',\n    APPLICATION_XML: 'application/xhtml+xml'\n};\n\n//Attributes\nconst DEFINITION_URL_ATTR = 'definitionurl';\nconst ADJUSTED_DEFINITION_URL_ATTR = 'definitionURL';\nconst SVG_ATTRS_ADJUSTMENT_MAP = {\n    attributename: 'attributeName',\n    attributetype: 'attributeType',\n    basefrequency: 'baseFrequency',\n    baseprofile: 'baseProfile',\n    calcmode: 'calcMode',\n    clippathunits: 'clipPathUnits',\n    diffuseconstant: 'diffuseConstant',\n    edgemode: 'edgeMode',\n    filterunits: 'filterUnits',\n    glyphref: 'glyphRef',\n    gradienttransform: 'gradientTransform',\n    gradientunits: 'gradientUnits',\n    kernelmatrix: 'kernelMatrix',\n    kernelunitlength: 'kernelUnitLength',\n    keypoints: 'keyPoints',\n    keysplines: 'keySplines',\n    keytimes: 'keyTimes',\n    lengthadjust: 'lengthAdjust',\n    limitingconeangle: 'limitingConeAngle',\n    markerheight: 'markerHeight',\n    markerunits: 'markerUnits',\n    markerwidth: 'markerWidth',\n    maskcontentunits: 'maskContentUnits',\n    maskunits: 'maskUnits',\n    numoctaves: 'numOctaves',\n    pathlength: 'pathLength',\n    patterncontentunits: 'patternContentUnits',\n    patterntransform: 'patternTransform',\n    patternunits: 'patternUnits',\n    pointsatx: 'pointsAtX',\n    pointsaty: 'pointsAtY',\n    pointsatz: 'pointsAtZ',\n    preservealpha: 'preserveAlpha',\n    preserveaspectratio: 'preserveAspectRatio',\n    primitiveunits: 'primitiveUnits',\n    refx: 'refX',\n    refy: 'refY',\n    repeatcount: 'repeatCount',\n    repeatdur: 'repeatDur',\n    requiredextensions: 'requiredExtensions',\n    requiredfeatures: 'requiredFeatures',\n    specularconstant: 'specularConstant',\n    specularexponent: 'specularExponent',\n    spreadmethod: 'spreadMethod',\n    startoffset: 'startOffset',\n    stddeviation: 'stdDeviation',\n    stitchtiles: 'stitchTiles',\n    surfacescale: 'surfaceScale',\n    systemlanguage: 'systemLanguage',\n    tablevalues: 'tableValues',\n    targetx: 'targetX',\n    targety: 'targetY',\n    textlength: 'textLength',\n    viewbox: 'viewBox',\n    viewtarget: 'viewTarget',\n    xchannelselector: 'xChannelSelector',\n    ychannelselector: 'yChannelSelector',\n    zoomandpan: 'zoomAndPan'\n};\n\nconst XML_ATTRS_ADJUSTMENT_MAP = {\n    'xlink:actuate': { prefix: 'xlink', name: 'actuate', namespace: NS.XLINK },\n    'xlink:arcrole': { prefix: 'xlink', name: 'arcrole', namespace: NS.XLINK },\n    'xlink:href': { prefix: 'xlink', name: 'href', namespace: NS.XLINK },\n    'xlink:role': { prefix: 'xlink', name: 'role', namespace: NS.XLINK },\n    'xlink:show': { prefix: 'xlink', name: 'show', namespace: NS.XLINK },\n    'xlink:title': { prefix: 'xlink', name: 'title', namespace: NS.XLINK },\n    'xlink:type': { prefix: 'xlink', name: 'type', namespace: NS.XLINK },\n    'xml:base': { prefix: 'xml', name: 'base', namespace: NS.XML },\n    'xml:lang': { prefix: 'xml', name: 'lang', namespace: NS.XML },\n    'xml:space': { prefix: 'xml', name: 'space', namespace: NS.XML },\n    xmlns: { prefix: '', name: 'xmlns', namespace: NS.XMLNS },\n    'xmlns:xlink': { prefix: 'xmlns', name: 'xlink', namespace: NS.XMLNS }\n};\n\n//SVG tag names adjustment map\nconst SVG_TAG_NAMES_ADJUSTMENT_MAP = (exports.SVG_TAG_NAMES_ADJUSTMENT_MAP = {\n    altglyph: 'altGlyph',\n    altglyphdef: 'altGlyphDef',\n    altglyphitem: 'altGlyphItem',\n    animatecolor: 'animateColor',\n    animatemotion: 'animateMotion',\n    animatetransform: 'animateTransform',\n    clippath: 'clipPath',\n    feblend: 'feBlend',\n    fecolormatrix: 'feColorMatrix',\n    fecomponenttransfer: 'feComponentTransfer',\n    fecomposite: 'feComposite',\n    feconvolvematrix: 'feConvolveMatrix',\n    fediffuselighting: 'feDiffuseLighting',\n    fedisplacementmap: 'feDisplacementMap',\n    fedistantlight: 'feDistantLight',\n    feflood: 'feFlood',\n    fefunca: 'feFuncA',\n    fefuncb: 'feFuncB',\n    fefuncg: 'feFuncG',\n    fefuncr: 'feFuncR',\n    fegaussianblur: 'feGaussianBlur',\n    feimage: 'feImage',\n    femerge: 'feMerge',\n    femergenode: 'feMergeNode',\n    femorphology: 'feMorphology',\n    feoffset: 'feOffset',\n    fepointlight: 'fePointLight',\n    fespecularlighting: 'feSpecularLighting',\n    fespotlight: 'feSpotLight',\n    fetile: 'feTile',\n    feturbulence: 'feTurbulence',\n    foreignobject: 'foreignObject',\n    glyphref: 'glyphRef',\n    lineargradient: 'linearGradient',\n    radialgradient: 'radialGradient',\n    textpath: 'textPath'\n});\n\n//Tags that causes exit from foreign content\nconst EXITS_FOREIGN_CONTENT = {\n    [$.B]: true,\n    [$.BIG]: true,\n    [$.BLOCKQUOTE]: true,\n    [$.BODY]: true,\n    [$.BR]: true,\n    [$.CENTER]: true,\n    [$.CODE]: true,\n    [$.DD]: true,\n    [$.DIV]: true,\n    [$.DL]: true,\n    [$.DT]: true,\n    [$.EM]: true,\n    [$.EMBED]: true,\n    [$.H1]: true,\n    [$.H2]: true,\n    [$.H3]: true,\n    [$.H4]: true,\n    [$.H5]: true,\n    [$.H6]: true,\n    [$.HEAD]: true,\n    [$.HR]: true,\n    [$.I]: true,\n    [$.IMG]: true,\n    [$.LI]: true,\n    [$.LISTING]: true,\n    [$.MENU]: true,\n    [$.META]: true,\n    [$.NOBR]: true,\n    [$.OL]: true,\n    [$.P]: true,\n    [$.PRE]: true,\n    [$.RUBY]: true,\n    [$.S]: true,\n    [$.SMALL]: true,\n    [$.SPAN]: true,\n    [$.STRONG]: true,\n    [$.STRIKE]: true,\n    [$.SUB]: true,\n    [$.SUP]: true,\n    [$.TABLE]: true,\n    [$.TT]: true,\n    [$.U]: true,\n    [$.UL]: true,\n    [$.VAR]: true\n};\n\n//Check exit from foreign content\nexports.causesExit = function(startTagToken) {\n    const tn = startTagToken.tagName;\n    const isFontWithAttrs =\n        tn === $.FONT &&\n        (Tokenizer.getTokenAttr(startTagToken, ATTRS.COLOR) !== null ||\n            Tokenizer.getTokenAttr(startTagToken, ATTRS.SIZE) !== null ||\n            Tokenizer.getTokenAttr(startTagToken, ATTRS.FACE) !== null);\n\n    return isFontWithAttrs ? true : EXITS_FOREIGN_CONTENT[tn];\n};\n\n//Token adjustments\nexports.adjustTokenMathMLAttrs = function(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        if (token.attrs[i].name === DEFINITION_URL_ATTR) {\n            token.attrs[i].name = ADJUSTED_DEFINITION_URL_ATTR;\n            break;\n        }\n    }\n};\n\nexports.adjustTokenSVGAttrs = function(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        const adjustedAttrName = SVG_ATTRS_ADJUSTMENT_MAP[token.attrs[i].name];\n\n        if (adjustedAttrName) {\n            token.attrs[i].name = adjustedAttrName;\n        }\n    }\n};\n\nexports.adjustTokenXMLAttrs = function(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        const adjustedAttrEntry = XML_ATTRS_ADJUSTMENT_MAP[token.attrs[i].name];\n\n        if (adjustedAttrEntry) {\n            token.attrs[i].prefix = adjustedAttrEntry.prefix;\n            token.attrs[i].name = adjustedAttrEntry.name;\n            token.attrs[i].namespace = adjustedAttrEntry.namespace;\n        }\n    }\n};\n\nexports.adjustTokenSVGTagName = function(token) {\n    const adjustedTagName = SVG_TAG_NAMES_ADJUSTMENT_MAP[token.tagName];\n\n    if (adjustedTagName) {\n        token.tagName = adjustedTagName;\n    }\n};\n\n//Integration points\nfunction isMathMLTextIntegrationPoint(tn, ns) {\n    return ns === NS.MATHML && (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS || tn === $.MTEXT);\n}\n\nfunction isHtmlIntegrationPoint(tn, ns, attrs) {\n    if (ns === NS.MATHML && tn === $.ANNOTATION_XML) {\n        for (let i = 0; i < attrs.length; i++) {\n            if (attrs[i].name === ATTRS.ENCODING) {\n                const value = attrs[i].value.toLowerCase();\n\n                return value === MIME_TYPES.TEXT_HTML || value === MIME_TYPES.APPLICATION_XML;\n            }\n        }\n    }\n\n    return ns === NS.SVG && (tn === $.FOREIGN_OBJECT || tn === $.DESC || tn === $.TITLE);\n}\n\nexports.isIntegrationPoint = function(tn, ns, attrs, foreignNS) {\n    if ((!foreignNS || foreignNS === NS.HTML) && isHtmlIntegrationPoint(tn, ns, attrs)) {\n        return true;\n    }\n\n    if ((!foreignNS || foreignNS === NS.MATHML) && isMathMLTextIntegrationPoint(tn, ns)) {\n        return true;\n    }\n\n    return false;\n};\n"]},"metadata":{},"sourceType":"script"}